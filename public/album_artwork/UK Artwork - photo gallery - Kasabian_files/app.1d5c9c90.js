var oauthConfig=function(){"use strict";var a="97ff18111c294e2581de2db4e5d7f302",b="https://embed.spotify.com/follow/1/callback/",c=/http[s]?:\/\/[^\/]+/.exec(b)[0];return{clientId:a,redirectUri:b,host:c,stateKey:"spotify_auth_state"}}(),oauth=function(){var a="sp_ac",b="oauth_cached",c=function(){return{readToken:function(){function a(a){var b,c,d;b=document.cookie.split("; ");var e={};for(d=b.length-1;d>=0;d--)c=b[d].split("="),e[c[0]]=c[1];return e[a]||null}return a("sp_at")},storeToken:function(b){try{return localStorage.setItem(a,b)}catch(c){return!1}},storeExpires:function(a){try{return localStorage.setItem(b,(new Date).getTime()+1e3*a)}catch(c){return!1}},emptyToken:function(){try{localStorage.removeItem(a),localStorage.removeItem(b)}catch(c){}},shouldCheck:function(){try{var a=+localStorage.getItem(b);return a<(new Date).getTime()}catch(c){return!0}}}};return new c}(),oauthManager=function(a,b){"use strict";function c(a,b){return new d(a,b)}var d=function(a,b){a=a||{},this.scopes=a.scopes||{},this._callback=b,this._state=this._generateState(),this._stateKey="sp-oauth-callback-"+this._state,this._authWindow=null,this._authWindowGotReference=!1,this._pollAuthWindowClosed=null};return d.prototype._toQueryString=function(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(encodeURIComponent(c)+"="+encodeURIComponent(a[c]));return b.join("&")},d.prototype._generateState=function(){for(var a=10,b="",c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",d=0;a>d;d++)b+=c.charAt(Math.floor(Math.random()*c.length));return b},d.prototype.request=function(){var c=400,d=700,e=screen.width/2-c/2,f=screen.height/2-d/2,g=this._state,h={client_id:b.clientId,redirect_uri:b.redirectUri,response_type:"code",state:g};this.scopes&&(h.scope=this.scopes.join(" ")),utils.addEventListener(window,"storage",this._receiveMessage.bind(this),!1),this._pollAuthWindowClosed=setInterval(function(){var b;this._authWindowGotReference?(null!=this._authWindow&&this._authWindow.closed||!this._authWindow)&&(b=a.readToken(),this._dispose(),this._processResponse(b)):(b=a.readToken(),null!==b&&(this._dispose(),this._processResponse(b)))}.bind(this),200),this._authWindow=window.open("https://accounts.spotify.com/authorize?"+this._toQueryString(h),"Spotify","menubar=no,location=no,resizable=no,scrollbars=no,status=no, width="+c+", height="+d+", top="+f+", left="+e),this._authWindowGotReference=null!=this._authWindow},d.prototype._receiveMessage=function(a){a.key===this._stateKey&&(this._dispose(),this._processResponse(a.newValue))},d.prototype._processResponse=function(a){if(null!==this._callback){var b;a?(b=this._callback,this._callback=null,b(null)):this._authWindowGotReference&&null==this._authWindow&&(b=this._callback,this._callback=null,b(new Error("access denied")))}},d.prototype._dispose=function(){null!=this._authWindow&&(this._authWindow.close(),this._authWindow=null),this._pollAuthWindowClosed&&(clearInterval(this._pollAuthWindowClosed),this._pollAuthWindowClosed=null),utils.removeEventListener(window,"storage",this._receiveMessage.bind(this),!1),localStorage.removeItem(this._stateKey)},{obtainToken:c}}(oauth,oauthConfig),analytics=function(){"use strict";window.ga=null;var a=function(){!function(a,b,c,d,e,f,g){a.GoogleAnalyticsObject=e,a[e]=a[e]||function(){(a[e].q=a[e].q||[]).push(arguments)},a[e].l=1*new Date,f=b.createElement(c),g=b.getElementsByTagName(c)[0],f.async=1,f.src=d,g.parentNode.insertBefore(f,g)}(window,document,"script","//www.google-analytics.com/analytics.js","ga"),window.ga("create","UA-5784146-20",{sampleRate:1,siteSpeedSampleRate:1,cookieDomain:"embed.spotify.com"});var a=window.location!==window.parent.location?document.referrer:document.location;window.ga("set","referrer",a),window.ga("send","pageview")},b=function(){a()},c=function(a,b,c){window.ga("send","event",{eventCategory:a,eventAction:b,eventLabel:c})},d=function(a,b,c,d){var e=["send","timing",a,b,c];d&&e.push(d),window.ga.apply(void 0,e)};return{init:b,trackEvent:c,trackTiming:d}}(),followApi=function(a){"use strict";function b(a,b){return this.category=a,this.variable=b,this.label=null,this.startTime=null,this.endTime=null,this}function c(a,b){var c=[];for(var d in b)b.hasOwnProperty(d)&&c.push(encodeURIComponent(d)+"="+encodeURIComponent(b[d]));return c.join("&"),c.length&&(a+="?"+c.join("&")),a}function d(a,b,d){var e={type:a.type,ids:[a.id],_nonce:(new Date).getTime()};a.fields&&(e.fields=a.fields.join(","));var h=c(f+"/me/following",e);g({url:h,type:"put",trackLabel:"Follow",accessToken:a.oauth_token},function(a){b(a)},function(a){d(a)})}function e(a,b,d){var e={type:a.type,ids:[a.id],_nonce:(new Date).getTime()};a.fields&&(e.fields=a.fields.join(","));var h=c(f+"/me/following",e);g({url:h,type:"delete",trackLabel:"Unfollow",accessToken:a.oauth_token},function(a){b(a)},function(a){d(a)})}b.prototype.start=function(){return this.startTime=(new Date).getTime(),this},b.prototype.end=function(a){return void 0!==a&&(this.label=a),this.endTime=(new Date).getTime(),this},b.prototype.send=function(){var b=this.endTime-this.startTime,c=36e5;return a&&b>0&&c>b&&a.trackTiming(this.category,this.variable,b,this.label),this};var f="https://api.spotify.com/v1",g=function(a,c,d){function e(a,b){var c=new XMLHttpRequest;return"withCredentials"in c?c.open(a,b,!0):"undefined"!=typeof XDomainRequest?(c=new XDomainRequest,c.open(a,b),c.timeout=1e4,c.onprogress=function(){},c.ontimeout=function(){if(d){var a="status"in g?g.status.toString():"522";d({type:"timeout",code:a})}}):c=null,c}var f=new b("Follow API",a.trackLabel);f.start();var g=e(a.type||"get",a.url);g&&(a.accessToken&&g.setRequestHeader("Authorization","Bearer "+a.accessToken),g.onload=function(){f.end(g.status).send();var a=+("status"in g?g.status.toString():"200");if(a>=200&&300>a){if(c)try{if(""!==g.responseText){var b=JSON.parse(g.responseText);c(b)}else c()}catch(e){d({type:"invalid",code:a})}}else d&&d({type:"error",code:a})},g.onerror=function(){if(f.end(g.status).send(),d){var a="status"in g?g.status.toString():null;d({type:"error",code:a})}},setTimeout(function(){g.send()},0))};return{follow:d,unfollow:e}},formatter=function(){"use strict";function a(a){var c=b(a),d=c.number.toString();return 1e3===c.multiplier?d+="k":1e6===c.multiplier&&(d+="m"),d}function b(a){var b=1;return a>1e6?(a/=1e6,a=Math.floor(10*a)/10,b=1e6):a>1e3&&(a/=1e3,a=Math.floor(10*a)/10,b=1e3),{number:a,multiplier:b}}return{formatNumber:a}}(),commandExecutor=function(){"use strict";function a(a){return e=2,d=a,this}function b(){if(null!==d){if(e--,!(e>=0))throw"Max attempts reached";d.execute(function(){d=null})}}function c(){d=null}var d,e;return{store:a,executePending:b,removePending:c}}(),utils=function(){var a=function(b,c){return(a=document.documentElement.classList?function(a,b){return a.classList.contains(b)}:function(a,b){if(!a||!a.className)return!1;var c=new RegExp("(^|\\s)"+b+"(\\s|$)");return a.className.match(c)})(b,c)},b=function(c,d){(b=document.documentElement.classList?function(a,b){a.classList.add(b)}:function(b,c){return b?void(a(b,c)||(b.className+=(b.className?" ":"")+c)):!1})(c,d)},c=function(a,b){(c=document.documentElement.classList?function(a,b){a.classList.remove(b)}:function(a,b){if(!a||!a.className)return!1;var c=new RegExp("(^|\\s)"+b+"(\\s|$)","g");a.className=a.className.replace(c,"$2")})(a,b)},d=function(a,b,c,e){(d=window.addEventListener?function(a,b,c,d){return a.addEventListener(b,c,d)}:function(a,b,c,d){return a.attachEvent("on"+b,c,d)})(a,b,c,e)},e=function(a,b,c,d){(e=window.removeEventListener?function(a,b,c,d){return a.removeEventListener(b,c,d)}:function(a,b,c,d){return a.detachEvent("on"+b,c,d)})(a,b,c,d)};return{addEventListener:d,removeEventListener:e,addClass:b,removeClass:c,containsClass:a}}(),SP=SP||{};SP.FollowButton=function(a,b,c,d,e,f,g,h){function i(){h.addEventListener(t,"click",function(){var a=new E(k()?D:C);f.store(a).executePending()},!1)}function j(a){v&&(v.innerHTML=b.formatNumber(a))}function k(){return x}function l(a){x=a}function m(){g.trackEvent("Follow","Options-Size",p.size),g.trackEvent("Follow","Options-ShowCount",p["show-count"]),g.trackEvent("Follow","Options-Id",p.id),g.trackEvent("Follow","Options-Type",p.type),g.trackEvent("Follow","Options-Theme",p.theme),window.performance&&window.performance.timing&&g.trackTiming("Follow Widget","From start to rendered",(new Date).getTime()-window.performance.timing.navigationStart),l(h.containsClass(r,"following")),u&&(y=+u.getAttribute("data-followers"),k()&&y--)}function n(){g.trackEvent("Follow","AuthDialog","Show"),d.obtainToken({scopes:["user-follow-read","user-follow-modify"]},function(a){null===a?f.executePending():f.removePending()}).request()}function o(a){g.init(),p=a,i(),m()}var p,q=a(g),r=document.querySelector(".widget"),s=r.querySelector(".bt-text"),t=r.querySelector("button"),u=r.querySelector(".count"),v=r.querySelector(".count .count-num.front"),w=r.querySelector(".count .count-num.back"),x=!1,y=0,z=function(){var a="flip",b=500;if(h.removeClass(r,"can-unfollow"),h.addClass(r,"following"),s.innerHTML=c.following,t.setAttribute("title",c["unfollow-tooltip"]),l(!0),u){var d=A(),e=function(){var b=y+1;j(b),h.removeClass(u,a),null!==d&&h.removeEventListener(u,d,f,!1)};if(null!==d){v&&w&&(w.style.width=v.offsetWidth+"px");var f=function(){setTimeout(e,b)};u&&(h.addEventListener(u,d,f,!1),h.addClass(u,a))}else e()}},A=function(){var a,b=document.createElement("fakeelement"),c={transition:"transitionend",OTransition:"oTransitionEnd",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"},d=null;for(a in c)if(void 0!==b.style[a]){d=c[a];break}return(A=function(){return d})()},B=function(){h.removeClass(r,"can-unfollow"),h.removeClass(r,"following"),s.innerHTML=c.follow,t.setAttribute("title",c["follow-tooltip"]),u&&j(y),l(!1)},C=function(a,b){if(null===e.readToken())n();else{var c=k();z(),q.follow({oauth_token:e.readToken(),type:p.type,id:p.id},function(){g.trackEvent("Follow","Follow",[p.type,p.id].join("/")),a()},function(a){c||B(),g.trackEvent("Follow","API call - Follow","Other error: "+[a.type,a.code].join("/")),e.emptyToken(),b()})}},D=function(a,b){if(null===e.readToken())n();else{var c=k();B(),q.unfollow({oauth_token:e.readToken(),type:p.type,id:p.id},function(){g.trackEvent("Follow","Unfollow",[p.type,p.id].join("/")),a()},function(a){c&&z(),g.trackEvent("Follow","API call - Unfollow","Other error: "+[a.type,a.code].join("/")),e.emptyToken(),b()})}},E=function(a){this.execute=function(b){var c=e.readToken();c?a(function(){b()},function(){n()}):n()}};return h.addEventListener(t,"mouseover",function(){h.containsClass(r,"can-unfollow")&&(s.innerHTML=c.unfollow)},!1),h.addEventListener(t,"mouseout",function(a){a=a||window.event;var b=window.event?a.srcElement:a.target,d=a.relatedTarget?a.relatedTarget:a.toElement;if(!d||"BUTTON"!==d.nodeName){for(;d!==b&&null!==d&&"BODY"!==d.nodeName;)d=d.parentNode;d!==b&&k()&&(s.innerHTML=c.following,h.containsClass(r,"can-unfollow")||h.addClass(r,"can-unfollow"))}},!1),{init:o}}(followApi,formatter,lang,oauthManager,oauth,commandExecutor,analytics,utils),SP.AuthDialog=function(){function a(a){a?(analytics.trackEvent("Follow","AuthDialog","Valid token returned"),oauth.storeToken(a)):(analytics.trackEvent("Follow","AuthDialog","Empty token returned"),oauth.emptyToken()),SP.FollowButton.closeAuthDialog()}function b(a){"wrong_authentication"!==a&&(window.console&&console.error&&console.error(a),analytics.trackEvent("Follow","AuthDialog","Error "+a)),SP.FollowButton.closeAuthDialog()}return{reportError:b,setOAuthToken:a}}();